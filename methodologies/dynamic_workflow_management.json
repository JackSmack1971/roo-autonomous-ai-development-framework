{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Dynamic Workflow State Management",
  "description": "Real-time workflow orchestration with autonomous task creation and adaptive routing",
  
  "workflow_state": {
    "schema": "WORKFLOW_STATE/V2",
    "project_id": "sample-app",
    "updated_at": "2025-08-25T16:30:00Z",
    "orchestrator_mode": "sparc-orchestrator",
    
    "current_phase": "implementation_with_concurrent_specialists",
    "workflow_intelligence": {
      "adaptive_routing_enabled": true,
      "quality_monitoring_active": true,
      "circuit_breakers_armed": true,
      "learning_mode": "active"
    },
    
    "active_tasks": [
      {
        "task_id": "impl-001",
        "mode": "sparc-code-implementer", 
        "status": "running",
        "objective": "Implement user authentication system per architecture specs",
        "created_by": "sparc-orchestrator",
        "created_at": "2025-08-25T14:00:00Z",
        "priority": "high",
        "parent_task": null,
        "children_tasks": ["sec-003", "perf-001"],
        "dependencies": ["arch-001-complete"],
        "estimated_completion": "2025-08-25T18:00:00Z",
        "progress_indicators": {
          "code_coverage": 0.87,
          "quality_score": 0.82,
          "security_validation": "pending"
        }
      },
      {
        "task_id": "sec-003",
        "mode": "security-reviewer",
        "status": "running", 
        "objective": "Security review of authentication implementation",
        "created_by": "sparc-code-implementer",
        "created_at": "2025-08-25T15:30:00Z",
        "priority": "high",
        "parent_task": "impl-001",
        "context": {
          "detection_trigger": "authentication_logic_implementation",
          "risk_level": "high",
          "business_criticality": "user authentication is core security function"
        },
        "dependencies": ["impl-001-authentication-module"],
        "estimated_completion": "2025-08-25T17:30:00Z"
      },
      {
        "task_id": "perf-001", 
        "mode": "performance-engineer",
        "status": "pending",
        "objective": "Validate authentication performance under load",
        "created_by": "sparc-code-implementer", 
        "created_at": "2025-08-25T15:45:00Z",
        "priority": "medium",
        "parent_task": "impl-001",
        "context": {
          "detection_trigger": "database_queries_without_proper_optimization",
          "performance_target": "sub_100ms_auth_response",
          "load_requirements": "1000_concurrent_users"
        },
        "dependencies": ["impl-001-complete", "sec-003-complete"],
        "estimated_completion": "2025-08-26T10:00:00Z"
      }
    ],
    
    "delegation_chains": [
      {
        "chain_id": "auth_implementation_chain",
        "sequence": [
          "sparc-orchestrator", 
          "sparc-code-implementer", 
          "security-reviewer",
          "performance-engineer"
        ],
        "current_depth": 3,
        "max_depth": 4,
        "circuit_breaker_status": "normal"
      }
    ],
    
    "detected_issues": [
      {
        "issue_id": "quality-001",
        "type": "test_coverage_gap",
        "severity": "medium",
        "detected_by": "quality-assurance-coordinator",
        "detected_at": "2025-08-25T16:15:00Z",
        "description": "Authentication error scenarios not fully covered by tests",
        "affected_tasks": ["impl-001"],
        "routing_recommendation": "sparc-tdd-engineer",
        "auto_create_task": true,
        "estimated_effort": "4_hours"
      }
    ],
    
    "circuit_breaker_states": {
      "infinite_delegation_prevention": {
        "status": "armed",
        "max_delegation_depth": 4,
        "current_max_depth": 3,
        "cooldown_period": "15_minutes"
      },
      "quality_regression_protection": {
        "status": "monitoring",
        "quality_threshold": 0.75,
        "current_quality_score": 0.85,
        "intervention_trigger": "three_consecutive_declines"
      },
      "resource_contention_management": {
        "status": "normal",
        "concurrent_task_limit": 8,
        "current_active_tasks": 3,
        "high_priority_task_limit": 4
      }
    },
    
    "quality_oversight": {
      "overall_quality_score": 0.85,
      "quality_trend": "stable",
      "active_quality_interventions": 1,
      "quality_gates_status": {
        "architecture_completeness": "passed",
        "security_validation": "in_progress", 
        "implementation_quality": "monitoring",
        "test_coverage": "intervention_required",
        "integration_readiness": "pending"
      }
    },
    
    "learning_state": {
      "patterns_recognized": [
        {
          "pattern": "authentication_implementation_requires_security_review",
          "confidence": 0.94,
          "success_rate": 0.89,
          "auto_apply": true
        },
        {
          "pattern": "database_operations_benefit_from_early_performance_validation", 
          "confidence": 0.87,
          "success_rate": 0.82,
          "auto_apply": true
        }
      ],
      "adaptations_applied": [
        {
          "adaptation": "auto_create_security_review_for_auth_code",
          "applied_at": "2025-08-25T15:30:00Z",
          "effectiveness": "pending_evaluation"
        }
      ]
    },
    
    "completed_phases": [
      {
        "phase": "specification",
        "completed_at": "2025-08-24T16:00:00Z",
        "quality_score": 0.91,
        "artifacts": ["specification.md", "acceptance-criteria.md"],
        "lessons_learned": ["early_stakeholder_validation_prevents_scope_creep"]
      },
      {
        "phase": "architecture", 
        "completed_at": "2025-08-25T10:00:00Z",
        "quality_score": 0.88,
        "artifacts": ["architecture.md", "component-diagram.svg"],
        "specialist_consultations": ["sparc-security-architect", "database-specialist"],
        "lessons_learned": ["proactive_specialist_involvement_reduces_rework_by_75_percent"]
      }
    ],
    
    "predictive_insights": {
      "upcoming_specialist_needs": [
        {
          "specialist": "integration-specialist",
          "predicted_need_time": "2025-08-26T14:00:00Z", 
          "confidence": 0.78,
          "trigger": "payment_gateway_integration_approaching",
          "preparation_actions": ["review_payment_api_documentation", "prepare_sandbox_environment"]
        }
      ],
      "potential_conflicts": [
        {
          "conflict_type": "security_vs_usability",
          "probability": 0.35,
          "context": "MFA_requirements_vs_user_experience",
          "prevention_actions": ["early_stakeholder_alignment_on_security_trade_offs"]
        }
      ],
      "quality_risks": [
        {
          "risk": "test_debt_accumulation",
          "probability": 0.42,
          "mitigation": "proactive_tdd_engineer_involvement",
          "trigger_monitoring": "test_coverage_below_90_percent"
        }
      ]
    },
    
    "autonomous_actions_taken": [
      {
        "action": "created_security_review_task",
        "timestamp": "2025-08-25T15:30:00Z",
        "trigger": "authentication_implementation_pattern_detected",
        "decision_confidence": 0.94,
        "outcome": "pending_completion"
      },
      {
        "action": "escalated_test_coverage_gap_to_tdd_engineer",
        "timestamp": "2025-08-25T16:15:00Z", 
        "trigger": "quality_assurance_coordinator_intervention",
        "decision_confidence": 0.89,
        "outcome": "task_created_and_assigned"
      }
    ],
    
    "system_health": {
      "workflow_velocity": 0.82,
      "quality_maintenance": 0.91,
      "autonomous_decision_accuracy": 0.87,
      "specialist_utilization_efficiency": 0.79,
      "overall_system_effectiveness": 0.85
    }
  },
  
  "dynamic_routing_rules": {
    "issue_auto_routing": {
      "security_vulnerabilities": {
        "priority": "critical",
        "route_to": "security-reviewer",
        "escalate_if_unresolved": "2_hours",
        "parallel_notification": ["sparc-orchestrator"]
      },
      "performance_bottlenecks": {
        "priority": "high", 
        "route_to": "performance-engineer",
        "auto_create_conditions": ["response_time_over_500ms", "database_query_complexity_high"],
        "context_requirements": ["performance_benchmarks", "load_requirements"]
      },
      "test_coverage_gaps": {
        "priority": "medium",
        "route_to": "sparc-tdd-engineer", 
        "auto_create_conditions": ["coverage_below_90_percent", "critical_path_untested"],
        "quality_gate_blocking": true
      }
    },
    
    "adaptive_prioritization": {
      "business_impact_multiplier": {
        "user_authentication": 1.5,
        "payment_processing": 2.0,
        "data_security": 1.8,
        "user_experience": 1.2,
        "administrative_functions": 0.8
      },
      "dependency_urgency_boost": {
        "blocking_other_tasks": 1.3,
        "critical_path_component": 1.4,
        "external_dependency_deadline": 1.6
      }
    },
    
    "circuit_breaker_responses": {
      "infinite_delegation_detected": {
        "action": "create_joint_task",
        "participants": ["conflicting_modes"],
        "escalate_to": "sparc-orchestrator",
        "cooldown_period": "30_minutes"
      },
      "quality_regression_threshold": {
        "action": "pause_affected_workflow",
        "create_intervention_task": "quality-assurance-coordinator",
        "require_explicit_continuation_approval": true
      },
      "resource_exhaustion": {
        "action": "priority_rebalancing",
        "pause_low_priority_tasks": true,
        "escalate_to": "sparc-orchestrator"
      }
    }
  },
  
  "learning_integration": {
    "pattern_recognition": {
      "success_pattern_tracking": {
        "minimum_occurrences": 3,
        "minimum_success_rate": 0.8,
        "confidence_threshold": 0.75
      },
      "failure_pattern_avoidance": {
        "failure_pattern_detection": "2_occurrences",
        "automatic_prevention": true,
        "alternative_routing": "required"
      }
    },
    
    "adaptive_intelligence": {
      "workflow_optimization": {
        "route_efficiency_learning": true,
        "quality_outcome_prediction": true,
        "resource_utilization_optimization": true
      },
      "specialist_matching": {
        "context_based_routing": true,
        "historical_success_weighting": true,
        "expertise_depth_assessment": true
      }
    }
  }
}